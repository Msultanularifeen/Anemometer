<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anemometer - Real-time Wind Speed</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        background: 'hsl(var(--background))',
                        foreground: 'hsl(var(--foreground))',
                        card: 'hsl(var(--card))',
                        'card-foreground': 'hsl(var(--card-foreground))',
                        popover: 'hsl(var(--popover))',
                        'popover-foreground': 'hsl(var(--popover-foreground))',
                        primary: 'hsl(var(--primary))',
                        'primary-foreground': 'hsl(var(--primary-foreground))',
                        secondary: 'hsl(var(--secondary))',
                        'secondary-foreground': 'hsl(var(--secondary-foreground))',
                        muted: 'hsl(var(--muted))',
                        'muted-foreground': 'hsl(var(--muted-foreground))',
                        accent: 'hsl(var(--accent))',
                        'accent-foreground': 'hsl(var(--accent-foreground))',
                        destructive: 'hsl(var(--destructive))',
                        'destructive-foreground': 'hsl(var(--destructive-foreground))',
                        border: 'hsl(var(--border))',
                        input: 'hsl(var(--input))',
                        ring: 'hsl(var(--ring))',
                        'chart-1': 'hsl(var(--chart-1))',
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer base {
            :root {
                --background: 0 0% 100%;
                --foreground: 224 71.4% 4.1%;
                --card: 0 0% 100%;
                --card-foreground: 224 71.4% 4.1%;
                --popover: 0 0% 100%;
                --popover-foreground: 224 71.4% 4.1%;
                --primary: 220 9.1% 45.1%;
                --primary-foreground: 210 20% 98%;
                --secondary: 220 14.3% 95.9%;
                --secondary-foreground: 220.9 39.3% 11%;
                --muted: 220 14.3% 95.9%;
                --muted-foreground: 220 8.9% 46.1%;
                --accent: 220 14.3% 95.9%;
                --accent-foreground: 220.9 39.3% 11%;
                --destructive: 0 84.2% 60.2%;
                --destructive-foreground: 210 20% 98%;
                --border: 220 13% 91%;
                --input: 220 13% 91%;
                --ring: 224 71.4% 4.1%;
                --radius: 0.5rem;
                --chart-1: 220 70% 50%;
            }

            .dark {
                --background: 224 71.4% 4.1%;
                --foreground: 210 20% 98%;
                --card: 224 71.4% 4.1%;
                --card-foreground: 210 20% 98%;
                --popover: 224 71.4% 4.1%;
                --popover-foreground: 210 20% 98%;
                --primary: 210 20% 98%;
                --primary-foreground: 220.9 39.3% 11%;
                --secondary: 215 27.9% 16.9%;
                --secondary-foreground: 210 20% 98%;
                --muted: 215 27.9% 16.9%;
                --muted-foreground: 217.9 10.6% 64.9%;
                --accent: 215 27.9% 16.9%;
                --accent-foreground: 210 20% 98%;
                --destructive: 0 62.8% 30.6%;
                --destructive-foreground: 210 20% 98%;
                --border: 215 27.9% 16.9%;
                --input: 215 27.9% 16.9%;
                --ring: 216 12.2% 83.9%;
            }
        }
        body {
            @apply bg-background text-foreground;
        }
    </style>
     <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.min.js"></script>
</head>
<body class="antialiased">
    <div id="root"></div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>

    <script type="module">
        // --- START: Firebase Configuration ---
        const firebaseConfig = {
          "projectId": "anemometer-fgsd",
          "appId": "1:474068960064:web:b4dc79e5112a18743b30a5",
          "apiKey": "AIzaSyAssOVvWLkzKMcL-kgyrlYNg05HEQUGBAo",
          "authDomain": "anemometer-fgsd.firebaseapp.com",
          "databaseURL": "https://anemometer-fgsd-default-rtdb.firebaseio.com"
        };
        // --- END: Firebase Configuration ---

        // Helper function for class names
        function cn(...inputs) {
            return inputs.filter(Boolean).join(' ');
        }
        
        // Theme toggle logic
        const ThemeToggle = () => {
            const [theme, setTheme] = React.useState(localStorage.getItem('theme') || 'dark');

            React.useEffect(() => {
                const root = window.document.documentElement;
                if (theme === 'dark') {
                    root.classList.add('dark');
                } else {
                    root.classList.remove('dark');
                }
                localStorage.setItem('theme', theme);
            }, [theme]);

            return React.createElement(
                'button',
                {
                    onClick: () => setTheme(theme === 'light' ? 'dark' : 'light'),
                    className: 'p-2 rounded-md hover:bg-accent'
                },
                theme === 'light' 
                    ? React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round"}, React.createElement('path', {d: "M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z" }))
                    : React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round"}, [React.createElement('circle', {cx:"12", cy:"12", r:"4"}), React.createElement('path', {d: "M12 2v2"}), React.createElement('path', {d: "M12 20v2"}), React.createElement('path', {d: "m4.93 4.93 1.41 1.41"}), React.createElement('path', {d: "m17.66 17.66 1.41 1.41"}), React.createElement('path', {d: "M2 12h2"}), React.createElement('path', {d: "M20 12h2"}), React.createElement('path', {d: "m6.34 17.66-1.41 1.41"}), React.createElement('path', {d: "m19.07 4.93-1.41 1.41"})])
            );
        };
        
        // Main App Component
        const App = () => {
            const [speedHistory, setSpeedHistory] = React.useState([]);
            const [error, setError] = React.useState(null);

            React.useEffect(() => {
                try {
                    const app = firebase.initializeApp(firebaseConfig);
                    const db = firebase.database(app);
                    const readingsRef = firebase.database().ref(db, 'readings');

                    const listener = firebase.database().onValue(readingsRef, (snapshot) => {
                        const data = snapshot.val();
                        if (data) {
                            const newHistory = Object.values(data)
                                .map(d => ({
                                    speed: typeof d.speed === 'number' ? d.speed : 0,
                                    timestamp: typeof d.timestamp === 'number' ? d.timestamp : Date.now(),
                                    time: new Date(d.timestamp || Date.now()).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
                                }))
                                .filter(d => d.timestamp > 0)
                                .sort((a, b) => a.timestamp - b.timestamp)
                                .slice(-30);
                            setSpeedHistory(newHistory);
                        } else {
                           setSpeedHistory([]);
                        }
                    }, (error) => {
                        console.error("Firebase read failed:", error);
                        setError("Failed to connect to the data stream.");
                    });

                    return () => firebase.database().off(readingsRef, 'value', listener);

                } catch (e) {
                    console.error("Firebase initialization failed:", e);
                    setError(e.message.includes("API key not valid") ? "FIREBASE ERROR: Invalid API Key. Please check the firebaseConfig object in index.html" : "Failed to initialize Firebase. Check configuration.");
                }
            }, []);
            
            const stats = React.useMemo(() => {
                if (speedHistory.length === 0) return { current: 0, avg: 0, min: 0, max: 0 };
                const speeds = speedHistory.map(s => s.speed);
                const validSpeeds = speeds.filter(s => s > 0);
                const current = speeds[speeds.length - 1] || 0;
                const avg = validSpeeds.length > 0 ? validSpeeds.reduce((a, b) => a + b, 0) / validSpeeds.length : 0;
                const min = validSpeeds.length > 0 ? Math.min(...validSpeeds) : 0;
                const max = validSpeeds.length > 0 ? Math.max(...validSpeeds) : 0;
                return { current, avg, min, max };
            }, [speedHistory]);

            const chartData = React.useMemo(() => {
                if (speedHistory.length > 0) return speedHistory;
                // Create placeholder data if history is empty
                return Array.from({ length: 30 }, (_, i) => ({
                    time: new Date(Date.now() - (29 - i) * 1000).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
                    speed: 0,
                }));
            }, [speedHistory]);


            if (error) {
                return React.createElement('div', { className: 'flex items-center justify-center h-screen bg-background' }, 
                    React.createElement('div', {className: 'max-w-md w-full border border-destructive/50 rounded-lg p-4 text-destructive'}, [
                         React.createElement('h3', {className: 'font-bold mb-2'}, 'Connection Error'),
                         React.createElement('p', null, error)
                    ])
                );
            }

            const { AreaChart, Area, XAxis, YAxis, Tooltip, ResponsiveContainer } = Recharts;
            const theme = localStorage.getItem('theme') || 'dark';
            const tickColor = theme === 'dark' ? '#9ca3af' : '#4b5563';


            return React.createElement('div', { className: 'flex min-h-screen w-full flex-col bg-background' },
                React.createElement('header', { className: 'flex h-16 items-center justify-between gap-4 border-b border-border bg-card px-6 sticky top-0 z-10' },
                    React.createElement('h1', { className: 'text-xl font-semibold' }, 'Anemometer'),
                    React.createElement(ThemeToggle)
                ),
                React.createElement('main', { className: 'flex-1 p-4 sm:p-6 md:p-8' },
                    React.createElement('div', { className: 'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-6' },
                        // Stat Cards
                        React.createElement(StatCard, { title: "Current Speed", value: stats.current, unit: "km/h" }),
                        React.createElement(StatCard, { title: "Average Speed", value: stats.avg, unit: "km/h" }),
                        React.createElement(StatCard, { title: "Minimum Speed", value: stats.min, unit: "km/h" }),
                        React.createElement(StatCard, { title: "Maximum Speed", value: stats.max, unit: "km/h" })
                    ),
                    React.createElement('div', { className: 'h-[400px] w-full bg-card border border-border rounded-lg p-4' },
                         React.createElement(ResponsiveContainer, { width: '100%', height: '100%' },
                            React.createElement(AreaChart, { data: chartData, margin: { top: 5, right: 20, bottom: 20, left: -10 } },
                                React.createElement('defs', {}, 
                                    React.createElement('linearGradient', { id: 'colorSpeed', x1: '0', y1: '0', x2: '0', y2: '1' },
                                        React.createElement('stop', { offset: '5%', stopColor: 'hsl(var(--chart-1))', stopOpacity: 0.8 }),
                                        React.createElement('stop', { offset: '95%', stopColor: 'hsl(var(--chart-1))', stopOpacity: 0 })
                                    )
                                ),
                                React.createElement(XAxis, { dataKey: 'time', stroke: tickColor, tickLine: false, axisLine: { stroke: tickColor, opacity: 0.5 }, tickMargin: 10, fontSize: 12 }),
                                React.createElement(YAxis, { stroke: tickColor, tickLine: false, axisLine: { stroke: tickColor, opacity: 0.5 }, tickMargin: 5, fontSize: 12, domain: [0, 'dataMax + 5'] }),
                                React.createElement(Tooltip, { contentStyle: { backgroundColor: 'hsl(var(--background))', borderColor: 'hsl(var(--border))' } }),
                                React.createElement(Area, { type: 'monotone', dataKey: 'speed', stroke: 'hsl(var(--chart-1))', fillOpacity: 1, fill: 'url(#colorSpeed)', strokeWidth: 2, dot:false, activeDot: { r: 6 } })
                            )
                        )
                    )
                )
            );
        };

        const StatCard = ({ title, value, unit }) => {
            return React.createElement('div', { className: 'bg-card border border-border rounded-lg p-4 transition-all hover:shadow-lg hover:-translate-y-1' },
                React.createElement('h3', { className: 'text-sm font-medium text-muted-foreground' }, title),
                React.createElement('div', { className: 'text-2xl font-bold tracking-tighter' },
                    `${value.toFixed(2)} `,
                    React.createElement('span', { className: 'text-sm font-medium text-muted-foreground' }, unit)
                )
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
