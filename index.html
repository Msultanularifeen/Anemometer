<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anemometer - Real-time Wind Speed</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/recharts/umd/Recharts.min.js"></script>

    <style>
        :root {
            --background: 0 0% 100%;
            --foreground: 224 71.4% 4.1%;
            --card: 0 0% 100%;
            --card-foreground: 224 71.4% 4.1%;
            --primary: 220 9.1% 45.1%;
            --primary-foreground: 210 20% 98%;
            --secondary: 220 14.3% 95.9%;
            --muted: 220 14.3% 95.9%;
            --muted-foreground: 220 8.9% 46.1%;
            --accent: 220 14.3% 95.9%;
            --border: 220 13% 91%;
            --chart-1: 220 70% 50%;
        }
        .dark {
            --background: 224 71.4% 4.1%;
            --foreground: 210 20% 98%;
            --card: 224 71.4% 4.1%;
            --card-foreground: 210 20% 98%;
            --primary: 210 20% 98%;
            --primary-foreground: 220.9 39.3% 11%;
            --secondary: 215 27.9% 16.9%;
            --muted: 215 27.9% 16.9%;
            --muted-foreground: 217.9 10.6% 64.9%;
            --accent: 215 27.9% 16.9%;
            --border: 215 27.9% 16.9%;
        }
        body {
            background-color: hsl(var(--background));
            color: hsl(var(--foreground));
        }
        .bg-card { background-color: hsl(var(--card)); }
        .text-card-foreground { color: hsl(var(--card-foreground)); }
        .border-b { border-bottom-width: 1px; }
        .border-border { border-color: hsl(var(--border)); }
        .text-muted-foreground { color: hsl(var(--muted-foreground)); }
        .bg-primary-10 { background-color: hsl(var(--primary) / 0.1); }
        .text-primary { color: hsl(var(--primary)); }
        .bg-transparent { background-color: transparent; }
        .shadow-none { box-shadow: none; }
        .border-none { border: none; }
        .text-amber-500 { color: #f59e0b; }
        .border-dashed { border-style: dashed; }
        .hover\:border-primary:hover { border-color: hsl(var(--primary)); }
        .hover\:shadow-lg:hover { box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05); }
        .hover\:-translate-y-1:hover { transform: translateY(-0.25rem); }
        .transition-all { transition-property: all; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 300ms; }
        .duration-300 { transition-duration: 300ms; }
        .fade-in-animate { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="font-sans antialiased">
    <div id="app-container" class="flex min-h-screen w-full flex-col" style="background-color: hsl(var(--background));">
        <header class="flex h-16 items-center justify-between gap-4 border-b px-6 sticky top-0 z-50 bg-card border-border">
            <div class="flex items-center gap-3">
                <h1 class="text-xl font-semibold tracking-tight text-card-foreground">Anemometer</h1>
            </div>
            <button id="theme-toggle" class="p-2 rounded-md hover:bg-accent">
                <svg id="theme-icon-light" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sun"><circle cx="12" cy="12" r="4"></circle><path d="M12 2v2"></path><path d="M12 20v2"></path><path d="m4.93 4.93 1.41 1.41"></path><path d="m17.66 17.66 1.41 1.41"></path><path d="M2 12h2"></path><path d="M20 12h2"></path><path dm17.66 6.34-1.41 1.41"></path></svg>
                <svg id="theme-icon-dark" xmlns="http://www.w3-org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-moon hidden"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path></svg>
            </button>
        </header>
        <main class="flex-1 p-4 sm:p-6 md:p-8">
            <div id="error-alert" class="hidden flex items-center justify-center h-[calc(100vh-12rem)] p-4">
                <div class="max-w-xl mx-auto border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive relative w-full rounded-lg border p-4">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4 absolute left-4 top-4"><path d="m21.73 18-8-14a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path><path d="M12 9v4"></path><path d="M12 17h.01"></path></svg>
                    <h5 id="error-title" class="mb-1 font-medium leading-none tracking-tight pl-7">Connection Error</h5>
                    <div id="error-description" class="text-sm [&_p]:leading-relaxed pl-7"></div>
                </div>
            </div>

            <div id="dashboard-content" class="grid grid-cols-1 gap-6">
                 <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="fade-in-animate" style="animation-delay: 100ms;">
                        <div class="border-dashed h-full transition-all duration-300 hover:border-primary hover:shadow-lg hover:-translate-y-1 rounded-lg border bg-card text-card-foreground shadow-sm">
                           <div class="flex flex-row items-center justify-between space-y-0 p-6 pb-2">
                                <h3 class="text-sm font-medium text-muted-foreground">Current Speed</h3>
                                <svg xmlns="http://wwwrano.ch/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4 text-muted-foreground"><path d="M13 3v7h9l-9 11v-7H4l9-11z"/></svg>
                            </div>
                            <div class="p-6 pt-0">
                                <div id="current-speed" class="text-2xl font-bold tracking-tighter text-card-foreground">0.00 <span class="text-sm font-medium text-muted-foreground">km/h</span></div>
                                <p class="text-xs text-muted-foreground">Latest reading from sensor</p>
                            </div>
                        </div>
                    </div>
                    <div class="fade-in-animate" style="animation-delay: 200ms;">
                         <div class="border-dashed h-full transition-all duration-300 hover:border-primary hover:shadow-lg hover:-translate-y-1 rounded-lg border bg-card text-card-foreground shadow-sm">
                            <div class="flex flex-row items-center justify-between space-y-0 p-6 pb-2">
                                <h3 class="text-sm font-medium text-muted-foreground">Average speed</h3>
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4 text-muted-foreground"><line x1="12" x2="12" y1="20" y2="10"></line><line x1="18" x2="18" y1="20" y2="4"></line><line x1="6" x2="6" y1="20" y2="16"></line></svg>
                            </div>
                            <div class="p-6 pt-0">
                                <div id="average-speed" class="text-2xl font-bold tracking-tighter text-card-foreground">0.00 <span class="text-sm font-medium text-muted-foreground">km/h</span></div>
                                <p class="text-xs text-muted-foreground">Average of last 30 readings</p>
                            </div>
                        </div>
                    </div>
                    <div class="fade-in-animate" style="animation-delay: 300ms;">
                         <div class="border-dashed h-full transition-all duration-300 hover:border-primary hover:shadow-lg hover:-translate-y-1 rounded-lg border bg-card text-card-foreground shadow-sm">
                            <div class="flex flex-row items-center justify-between space-y-0 p-6 pb-2">
                                <h3 class="text-sm font-medium text-muted-foreground">Minimum Speed</h3>
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4 text-muted-foreground"><polyline points="22 12 16 12 14 15 10 9 8 12 2 12"></polyline><path d="M5.45 5.45 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.55A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.45z"></path></svg>
                            </div>
                            <div class="p-6 pt-0">
                                <div id="min-speed" class="text-2xl font-bold tracking-tighter text-card-foreground">0.00 <span class="text-sm font-medium text-muted-foreground">km/h</span></div>
                                <p class="text-xs text-muted-foreground">Lowest reading</p>
                            </div>
                        </div>
                    </div>
                    <div class="fade-in-animate" style="animation-delay: 400ms;">
                         <div class="border-dashed h-full transition-all duration-300 hover:border-primary hover:shadow-lg hover:-translate-y-1 rounded-lg border bg-card text-card-foreground shadow-sm">
                            <div class="flex flex-row items-center justify-between space-y-0 p-6 pb-2">
                                <h3 class="text-sm font-medium text-muted-foreground">Maximum Speed</h3>
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4 text-muted-foreground"><polyline points="22 12 16 12 14 15 10 9 8 12 2 12"></polyline><path d="M5.45 5.45 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.55A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.45z"></path></svg>
                            </div>
                            <div class="p-6 pt-0">
                                <div id="max-speed" class="text-2xl font-bold tracking-tighter text-card-foreground">0.00 <span class="text-sm font-medium text-muted-foreground">km/h</span></div>
                                <p class="text-xs text-muted-foreground">Highest reading</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2 fade-in-animate" style="animation-delay: 500ms;">
                        <div class="h-full flex flex-col border-dashed rounded-lg border bg-card text-card-foreground shadow-sm">
                             <div class="p-6">
                                <h3 class="text-lg font-semibold text-card-foreground">Real-time Wind Speed (Last 30 readings)</h3>
                            </div>
                            <div id="chart-container" class="flex-1 -mt-4 h-full w-full min-h-[350px]"></div>
                        </div>
                    </div>
                    <div class="lg:col-span-1 fade-in-animate" style="animation-delay: 600ms;">
                        <div class="border-none shadow-none bg-transparent flex flex-col h-full rounded-lg bg-card text-card-foreground">
                            <div class="p-6 pb-4">
                                <div class="flex items-center gap-3 mb-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-6 w-6 text-primary"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M22 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                                    <h3 class="text-lg font-semibold">A Project by BS Physics Students</h3>
                                </div>
                                <p class="text-sm text-muted-foreground">Batch 2024-2028</p>
                            </div>
                            <div class="p-6 pt-0 flex-1 flex flex-col justify-between">
                                <div class="flex flex-col gap-3">
                                    <div class="flex items-start gap-3"><div class="bg-primary-10 p-2 rounded-full"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4 text-primary"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></svg></div><div><p class="text-sm font-semibold">Masoom Ali</p><p class="text-xs text-muted-foreground">Mechanical Work</p></div></div>
                                    <div class="flex items-start gap-3"><div class="bg-primary-10 p-2 rounded-full"><svg xmlns="http://wwwrano.ch/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4 text-primary"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg></div><div><p class="text-sm font-semibold">Muhammad Sultan Ul Arifeen</p><p class="text-xs text-muted-foreground">Programming & Electronics</p></div></div>
                                    <div class="flex items-start gap-3"><div class="bg-primary-10 p-2 rounded-full"><svg xmlns="http://wwwrano.ch/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4 text-primary"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg></div><div><p class="text-sm font-semibold">Website Designed & Developed By</p><p class="text-xs text-muted-foreground">Muhammad Sultan Ul Arifeen</p></div></div>
                                </div>
                                <div class="mt-4">
                                    <div class="my-3 border-t border-border"></div>
                                    <div class="flex items-center gap-3 mb-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5 text-amber-500"><path d="M12 15-3.4 4.8C2 7.5 2 13 6.6 17.4c2.5 2.5 6 3.4 9.4 2.4l-2.6-2.6L12 15Z"></path><path d="m21.4 17.4-4-4-2.6 2.6c3.4 1 6.9.1 9.4-2.4C22 13 22 7.5 18.6 4.8L12 12l2.6 2.6Z"></path></svg><p class="text-sm font-semibold">Special Thanks</p></div>
                                    <div class="text-xs text-muted-foreground space-y-1"><p>Principal Azhar Kaisar</p><p>Professor Muhammad Farooq Ibadat</p></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // --- START: Firebase Configuration ---
        // This is a public configuration and is safe to be in the client-side code.
        const firebaseConfig = {
          apiKey: "AIzaSyAssOVvWLkzKMcL-kgyrlYNg05HEQUGBAo",
          authDomain: "anemometer-fgsd.firebaseapp.com",
          databaseURL: "https://anemometer-fgsd-default-rtdb.firebaseio.com",
          projectId: "anemometer-fgsd",
          storageBucket: "anemometer-fgsd.appspot.com",
          messagingSenderId: "474068960064",
          appId: "1:474068960064:web:b4dc79e5112a18743b30a5"
        };
        // --- END: Firebase Configuration ---

        // --- THEME ---
        const themeToggle = document.getElementById('theme-toggle');
        const lightIcon = document.getElementById('theme-icon-light');
        const darkIcon = document.getElementById('theme-icon-dark');

        const applyTheme = (theme) => {
            if (theme === 'dark') {
                document.documentElement.classList.add('dark');
                lightIcon.classList.add('hidden');
                darkIcon.classList.remove('hidden');
            } else {
                document.documentElement.classList.remove('dark');
                lightIcon.classList.remove('hidden');
                darkIcon.classList.add('hidden');
            }
        };

        const currentTheme = localStorage.getItem('theme') || 'dark';
        applyTheme(currentTheme);

        themeToggle.addEventListener('click', () => {
            const newTheme = document.documentElement.classList.contains('dark') ? 'light' : 'dark';
            localStorage.setItem('theme', newTheme);
            applyTheme(newTheme);
            renderChart(speedHistory); // Re-render chart with new theme colors
        });


        // --- DOM Elements ---
        const currentSpeedEl = document.getElementById('current-speed');
        const averageSpeedEl = document.getElementById('average-speed');
        const minSpeedEl = document.getElementById('min-speed');
        const maxSpeedEl = document.getElementById('max-speed');
        const chartContainer = document.getElementById('chart-container');
        const errorAlertEl = document.getElementById('error-alert');
        const errorDescEl = document.getElementById('error-description');
        const dashboardContentEl = document.getElementById('dashboard-content');

        let speedHistory = [];

        // --- Chart Rendering ---
        const { AreaChart, Area, XAxis, YAxis, Tooltip, ResponsiveContainer, Legend } = Recharts;

        function renderChart(data) {
            const isDark = document.documentElement.classList.contains('dark');
            const themeColor = isDark ? 'hsl(220 70% 50%)' : 'hsl(220 70% 50%)';
            const axisColor = isDark ? '#FFFFFF' : '#333333';

            const yDomain = [0, Math.max(10, Math.max(...data.map(d => d.speed)) + 5)];
            
            const chart = React.createElement(
                ResponsiveContainer,
                { width: '100%', height: '100%' },
                React.createElement(
                    AreaChart,
                    { data: data, margin: { top: 5, right: 20, left: -10, bottom: 20 } },
                    React.createElement('defs', null,
                        React.createElement('linearGradient', { id: 'colorUv', x1: '0', y1: '0', x2: '0', y2: '1' },
                            React.createElement('stop', { offset: '5%', stopColor: themeColor, stopOpacity: 0.4 }),
                            React.createElement('stop', { offset: '95%', stopColor: themeColor, stopOpacity: 0 })
                        )
                    ),
                    React.createElement(XAxis, { dataKey: 'time', stroke: axisColor, fontSize: 12, tickLine: false, axisLine: { opacity: 0.2 }, tickMargin: 10 }),
                    React.createElement(YAxis, { stroke: axisColor, fontSize: 12, tickLine: false, axisLine: { opacity: 0.2 }, tickMargin: 10, domain: yDomain }),
                    React.createElement(Tooltip, {
                        contentStyle: {
                            backgroundColor: isDark ? 'hsl(224 71.4% 4.1% / 0.8)' : 'hsl(0 0% 100% / 0.8)',
                            borderColor: isDark ? 'hsl(215 27.9% 16.9%)' : 'hsl(220 13% 91%)',
                            color: isDark ? 'white' : 'black',
                            backdropFilter: 'blur(4px)'
                        },
                        cursor: { stroke: themeColor, strokeWidth: 1 }
                    }),
                    React.createElement(Area, { type: 'monotone', dataKey: 'speed', stroke: themeColor, strokeWidth: 2, fillOpacity: 1, fill: 'url(#colorUv)' })
                )
            );
            ReactDOM.render(chart, chartContainer);
        }

        function updateUI(history) {
            if (history.length === 0) return;
            const speeds = history.map(s => s.speed);
            const validSpeeds = speeds.filter(s => s > 0);

            const current = speeds[speeds.length - 1];
            const avg = validSpeeds.length > 0 ? validSpeeds.reduce((acc, curr) => acc + curr, 0) / validSpeeds.length : 0;
            const min = validSpeeds.length > 0 ? Math.min(...validSpeeds) : 0;
            const max = validSpeeds.length > 0 ? Math.max(...validSpeeds) : 0;
            
            currentSpeedEl.innerHTML = `${current.toFixed(2)} <span class="text-sm font-medium text-muted-foreground">km/h</span>`;
            averageSpeedEl.innerHTML = `${avg.toFixed(2)} <span class="text-sm font-medium text-muted-foreground">km/h</span>`;
            minSpeedEl.innerHTML = `${min.toFixed(2)} <span class="text-sm font-medium text-muted-foreground">km/h</span>`;
            maxSpeedEl.innerHTML = `${max.toFixed(2)} <span class="text-sm font-medium text-muted-foreground">km/h</span>`;

            renderChart(history);
        }

        // --- Firebase Logic ---
        try {
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            } else {
                firebase.app();
            }

            const db = firebase.database();
            const readingsRef = db.ref('readings');

            readingsRef.on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    const newHistory = Object.values(data)
                        .map(d => ({
                            speed: typeof d.speed === 'number' ? d.speed : 0,
                            timestamp: typeof d.timestamp === 'number' ? d.timestamp : Date.now(),
                            time: new Date(d.timestamp || Date.now()).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
                        }))
                        .sort((a, b) => a.timestamp - b.timestamp)
                        .slice(-30);
                    speedHistory = newHistory;
                } else {
                    speedHistory = Array.from({ length: 30 }, (_, i) => ({
                        speed: 0,
                        timestamp: Date.now() - (30 - i) * 1000,
                        time: new Date(Date.now() - (30 - i) * 1000).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
                    }));
                }
                updateUI(speedHistory);
                dashboardContentEl.classList.remove('hidden');
                errorAlertEl.classList.add('hidden');
            }, (error) => {
                console.error("Firebase read failed:", error);
                errorDescEl.textContent = "Failed to connect to the data stream. Please check your Firebase setup and security rules. Error: " + error.message;
                dashboardContentEl.classList.add('hidden');
                errorAlertEl.classList.remove('hidden');
            });

        } catch (e) {
            console.error("Firebase initialization failed:", e);
            errorDescEl.textContent = "Failed to initialize Firebase. Please check your configuration. It's possible the API keys are incorrect. Error: " + e.message;
            dashboardContentEl.classList.add('hidden');
            errorAlertEl.classList.remove('hidden');
        }
      });
    </script>
</body>
</html>
