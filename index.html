<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Anemometer Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root {
            --background: 0 0% 100%;
            --foreground: 224 71.4% 4.1%;
            --card: 0 0% 100%;
            --card-foreground: 224 71.4% 4.1%;
            --primary: 220 9.1% 45.1%;
            --primary-foreground: 210 20% 98%;
            --secondary: 220 14.3% 95.9%;
            --muted: 220 14.3% 95.9%;
            --muted-foreground: 220 8.9% 46.1%;
            --accent: 220 14.3% 95.9%;
            --border: 220 13% 91%;
            --chart-1: 220 70% 50%;
            --radius: 0.5rem;
        }

        .dark {
            --background: 224 71.4% 4.1%;
            --foreground: 210 20% 98%;
            --card: 224 71.4% 4.1%;
            --card-foreground: 210 20% 98%;
            --primary: 210 20% 98%;
            --primary-foreground: 220.9 39.3% 11%;
            --secondary: 215 27.9% 16.9%;
            --muted: 215 27.9% 16.9%;
            --muted-foreground: 217.9 10.6% 64.9%;
            --accent: 215 27.9% 16.9%;
            --border: 215 27.9% 16.9%;
            --chart-1: 220 70% 50%;
        }

        body {
            background-color: hsl(var(--background));
            color: hsl(var(--foreground));
            font-family: sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in-animate {
            animation: fadeIn 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="min-h-screen w-full flex flex-col">

    <!-- Header -->
    <header class="flex h-16 items-center justify-between gap-4 border-b px-6 sticky top-0 z-50" style="background-color: hsl(var(--card)); border-color: hsl(var(--border));">
        <div class="flex items-center gap-3">
            <h1 class="text-xl font-semibold tracking-tight" style="color: hsl(var(--card-foreground));">
                Anemometer
            </h1>
        </div>
        <button id="theme-toggle" class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium h-10 w-10 border" style="background-color: transparent; border-color: hsl(var(--border));">
            <svg id="sun-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all"><path d="M12 1v2m0 18v2M4.2 4.2l1.4 1.4m12.8 12.8l1.4 1.4M1 12h2m18 0h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4"/><circle cx="12" cy="12" r="5"/></svg>
            <svg id="moon-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>
            <span class="sr-only">Toggle theme</span>
        </button>
    </header>

    <!-- Main Content -->
    <main class="flex-1 p-4 sm:p-6 md:p-8">
        <div id="dashboard-content" class="grid grid-cols-1 gap-6">
            <!-- Cards -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                <div class="fade-in-animate rounded-lg border bg-card text-card-foreground shadow-sm border-dashed" style="animation-delay: 100ms;">
                    <div class="p-6 flex flex-row items-center justify-between space-y-0 pb-2"><h3 class="text-sm font-medium" style="color: hsl(var(--muted-foreground));">Current Speed</h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4" style="color: hsl(var(--muted-foreground));"><path d="M13 2 3 14h9l-1 8 10-12h-9l1-8z"/></svg></div>
                    <div class="p-6 pt-0"><div id="current-speed" class="text-2xl font-bold tracking-tighter">0.00 <span class="text-sm font-medium" style="color: hsl(var(--muted-foreground));">km/h</span></div><p class="text-xs" style="color: hsl(var(--muted-foreground));">Latest reading from sensor</p></div>
                </div>
                <div class="fade-in-animate rounded-lg border bg-card text-card-foreground shadow-sm border-dashed" style="animation-delay: 200ms;">
                    <div class="p-6 flex flex-row items-center justify-between space-y-0 pb-2"><h3 class="text-sm font-medium" style="color: hsl(var(--muted-foreground));">Average speed</h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4" style="color: hsl(var(--muted-foreground));"><line x1="12" x2="12" y1="20" y2="10"/><line x1="18" x2="18" y1="20" y2="4"/><line x1="6" x2="6" y1="20" y2="16"/></svg></div>
                    <div class="p-6 pt-0"><div id="average-speed" class="text-2xl font-bold tracking-tighter">0.00 <span class="text-sm font-medium" style="color: hsl(var(--muted-foreground));">km/h</span></div><p class="text-xs" style="color: hsl(var(--muted-foreground));">Average of last 30 readings</p></div>
                </div>
                <div class="fade-in-animate rounded-lg border bg-card text-card-foreground shadow-sm border-dashed" style="animation-delay: 300ms;">
                    <div class="p-6 flex flex-row items-center justify-between space-y-0 pb-2"><h3 class="text-sm font-medium" style="color: hsl(var(--muted-foreground));">Minimum Speed</h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4" style="color: hsl(var(--muted-foreground));"><path d="M13 2 3 14h9l-1 8 10-12h-9l1-8z"/></svg></div>
                    <div class="p-6 pt-0"><div id="min-speed" class="text-2xl font-bold tracking-tighter">0.00 <span class="text-sm font-medium" style="color: hsl(var(--muted-foreground));">km/h</span></div><p class="text-xs" style="color: hsl(var(--muted-foreground));">Lowest reading</p></div>
                </div>
                <div class="fade-in-animate rounded-lg border bg-card text-card-foreground shadow-sm border-dashed" style="animation-delay: 400ms;">
                    <div class="p-6 flex flex-row items-center justify-between space-y-0 pb-2"><h3 class="text-sm font-medium" style="color: hsl(var(--muted-foreground));">Maximum Speed</h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4" style="color: hsl(var(--muted-foreground));"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg></div>
                    <div class="p-6 pt-0"><div id="max-speed" class="text-2xl font-bold tracking-tighter">0.00 <span class="text-sm font-medium" style="color: hsl(var(--muted-foreground));">km/h</span></div><p class="text-xs" style="color: hsl(var(--muted-foreground));">Highest reading</p></div>
                </div>
            </div>

            <!-- Chart and Credits -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2 fade-in-animate rounded-lg border bg-card text-card-foreground shadow-sm border-dashed h-full flex flex-col" style="animation-delay: 500ms;">
                    <div class="p-6"><h3 class="text-lg font-semibold">Real-time Wind Speed (Last 30 readings)</h3></div>
                    <div class="p-6 pt-0 flex-1 -mt-4" id="chart-container" style="min-height: 350px;"></div>
                </div>
                <div class="lg:col-span-1 fade-in-animate bg-transparent flex flex-col h-full" style="animation-delay: 600ms;">
                    <div class="p-6 pb-4"><div class="flex items-center gap-3 mb-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="hsl(var(--primary))" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-6 w-6"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg><h3 class="text-lg font-semibold" style="color: hsl(var(--card-foreground));">A Project by BS Physics Students</h3></div><p class="text-sm text-muted-foreground">Batch 2024-2028</p></div>
                    <div class="p-6 pt-0 flex-1 flex flex-col justify-between"><div class="flex flex-col gap-3"><div class="flex items-start gap-3"><div class="bg-primary/10 p-2 rounded-full" style="background-color: hsla(var(--primary), 0.1);"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="hsl(var(--primary))" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22V12"/></svg></div><div><p class="text-sm font-semibold">Masoom Ali</p><p class="text-xs" style="color: hsl(var(--muted-foreground));">Mechanical Work</p></div></div><div class="flex items-start gap-3"><div class="p-2 rounded-full" style="background-color: hsla(var(--primary), 0.1);"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="hsl(var(--primary))" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg></div><div><p class="text-sm font-semibold">Muhammad Sultan Ul Arifeen</p><p class="text-xs" style="color: hsl(var(--muted-foreground));">Programming & Electronics</p></div></div><div class="flex items-start gap-3"><div class="p-2 rounded-full" style="background-color: hsla(var(--primary), 0.1);"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="hsl(var(--primary))" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4"><path d="M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"/></svg></div><div><p class="text-sm font-semibold">Website Designed & Developed By</p><p class="text-xs" style="color: hsl(var(--muted-foreground));">Muhammad Sultan Ul Arifeen</p></div></div></div><div class="mt-4"><hr class="my-3" style="border-color: hsl(var(--border));"/><div class="flex items-center gap-3 mb-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5"><path d="M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.3-.8.8l1.8 8.4.5 2.3L8.2 22c.1.5.7.5.8.1z"/></svg><p class="text-sm font-semibold">Special Thanks</p></div><div class="text-xs space-y-1" style="color: hsl(var(--muted-foreground));"><p>Principal Azhar Kaisar</p><p>Professor Muhammad Farooq Ibadat</p></div></div></div>
                </div>
            </div>
        </div>
        <div id="error-alert" class="hidden items-center justify-center h-[calc(100vh-12rem)] p-4">
             <div class="max-w-xl mx-auto relative w-full rounded-lg border p-4 border-red-500/50 text-red-500"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4 absolute left-4 top-4"><path d="m21.73 18-8-14a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg><div class="ml-7"><h5 class="mb-1 font-medium leading-none tracking-tight">Connection Error</h5><div id="error-message" class="text-sm"></div></div></div>
        </div>
    </main>

    <script>
        // --- THEME TOGGLING ---
        const themeToggle = document.getElementById('theme-toggle');
        const sunIcon = document.getElementById('sun-icon');
        const moonIcon = document.getElementById('moon-icon');
        const html = document.documentElement;

        const applyTheme = (theme) => {
            if (theme === 'dark') {
                html.classList.add('dark');
                sunIcon.style.display = 'none';
                moonIcon.style.display = 'block';
                moonIcon.classList.remove('scale-0');
                sunIcon.classList.add('scale-0');
            } else {
                html.classList.remove('dark');
                sunIcon.style.display = 'block';
                moonIcon.style.display = 'none';
                sunIcon.classList.remove('scale-0');
                moonIcon.classList.add('scale-0');
            }
        };

        const storedTheme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const currentTheme = storedTheme || (prefersDark ? 'dark' : 'light');
        applyTheme(currentTheme);

        themeToggle.addEventListener('click', () => {
            const newTheme = html.classList.contains('dark') ? 'light' : 'dark';
            localStorage.setItem('theme', newTheme);
            applyTheme(newTheme);
        });

        // --- FIREBASE & DASHBOARD LOGIC ---
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY", // Replace with your actual Firebase config
            authDomain: "anemometer-fgsd.firebaseapp.com",
            databaseURL: "https://anemometer-fgsd-default-rtdb.firebaseio.com",
            projectId: "anemometer-fgsd",
            storageBucket: "anemometer-fgsd.appspot.com",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // WARNING: Replace the placeholder values above with your actual
        // Firebase project configuration, otherwise the app will not connect.

        try {
            firebase.initializeApp(firebaseConfig);
            const db = firebase.database();
            const readingsRef = db.ref("readings");

            const currentSpeedEl = document.getElementById('current-speed');
            const averageSpeedEl = document.getElementById('average-speed');
            const minSpeedEl = document.getElementById('min-speed');
            const maxSpeedEl = document.getElementById('max-speed');

            const { AreaChart, Area, XAxis, YAxis, Tooltip, ResponsiveContainer, Legend } = Recharts;

            let chart;
            const renderChart = (data) => {
                const isDark = document.documentElement.classList.contains('dark');
                const axisColor = isDark ? '#FFFFFF' : '#666666';

                const chartEl = (
                    React.createElement(ResponsiveContainer, { width: '100%', height: '100%' },
                        React.createElement(AreaChart, { data: data, margin: { top: 5, right: 20, left: -10, bottom: 20 } },
                            React.createElement('defs', null,
                                React.createElement('linearGradient', { id: 'glow', x1: '0', y1: '0', x2: '0', y2: '1' },
                                    React.createElement('stop', { offset: '5%', stopColor: 'hsl(var(--chart-1))', stopOpacity: 0.4 }),
                                    React.createElement('stop', { offset: '95%', stopColor: 'hsl(var(--chart-1))', stopOpacity: 0 })
                                )
                            ),
                            React.createElement(XAxis, { dataKey: "time", stroke: axisColor, fontSize: 12, tickLine: false, axisLine: { stroke: axisColor, opacity: 0.2 }, tickMargin: 10 }),
                            React.createElement(YAxis, { stroke: axisColor, fontSize: 12, tickLine: false, axisLine: { stroke: axisColor, opacity: 0.2 }, tickMargin: 10, domain: [0, 'dataMax + 5'] }),
                            React.createElement(Tooltip, {
                                contentStyle: {
                                    backgroundColor: 'hsl(var(--background) / 0.8)',
                                    borderColor: 'hsl(var(--border))',
                                    backdropFilter: 'blur(4px)'
                                },
                                 formatter: (value) => [`${Number(value).toFixed(2)} km/h`, 'Speed']
                            }),
                            React.createElement(Area, { type: "monotone", dataKey: "speed", stroke: "hsl(var(--chart-1))", strokeWidth: 2, fillOpacity: 1, fill: "url(#glow)", dot: false, activeDot: { r: 6 } })
                        )
                    )
                );
                ReactDOM.render(chartEl, document.getElementById('chart-container'));
            };

            readingsRef.on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    const newHistory = Object.values(data)
                        .map(d => ({
                            speed: typeof d.speed === "number" ? d.speed : 0,
                            timestamp: typeof d.timestamp === "number" ? d.timestamp : Date.now(),
                            time: new Date(d.timestamp || Date.now()).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
                        }))
                        .filter(d => d.timestamp > 0)
                        .sort((a, b) => a.timestamp - b.timestamp)
                        .slice(-30);
                    
                    if (newHistory.length > 0) {
                        const speeds = newHistory.map(s => s.speed);
                        const validSpeeds = speeds.filter(s => s > 0);
                        
                        const current = speeds[speeds.length - 1];
                        const avg = validSpeeds.length > 0 ? validSpeeds.reduce((acc, curr) => acc + curr, 0) / validSpeeds.length : 0;
                        const min = validSpeeds.length > 0 ? Math.min(...validSpeeds) : 0;
                        const max = validSpeeds.length > 0 ? Math.max(...validSpeeds) : 0;

                        currentSpeedEl.innerHTML = `${current.toFixed(2)} <span class="text-sm font-medium" style="color: hsl(var(--muted-foreground));">km/h</span>`;
                        averageSpeedEl.innerHTML = `${avg.toFixed(2)} <span class="text-sm font-medium" style="color: hsl(var(--muted-foreground));">km/h</span>`;
                        minSpeedEl.innerHTML = `${min.toFixed(2)} <span class="text-sm font-medium" style="color: hsl(var(--muted-foreground));">km/h</span>`;
                        maxSpeedEl.innerHTML = `${max.toFixed(2)} <span class="text-sm font-medium" style="color: hsl(var(--muted-foreground));">km/h</span>`;

                        renderChart(newHistory);
                    }
                    
                }
            }, (error) => {
                console.error("Firebase read failed:", error);
                document.getElementById('dashboard-content').classList.add('hidden');
                document.getElementById('error-alert').classList.remove('hidden');
                document.getElementById('error-message').innerText = "Failed to connect to the data stream. Please check your Firebase setup and security rules.";
            });

        } catch (e) {
            console.error("Firebase initialization failed:", e);
            document.getElementById('dashboard-content').classList.add('hidden');
            document.getElementById('error-alert').classList.remove('hidden');
            document.getElementById('error-message').innerText = "Failed to initialize Firebase. Please check your configuration. Make sure you have replaced the placeholder API keys in the HTML file.";
        }

    </script>
    <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
</body>
</html>
