<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anemometer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/lucide-react/dist/lucide-react.js"></script>
    <script src="https://unpkg.com/recharts/umd/Recharts.min.js"></script>
    <style>
        :root {
            --background: 224 71.4% 4.1%;
            --foreground: 210 20% 98%;
            --card: 224 71.4% 4.1%;
            --card-foreground: 210 20% 98%;
            --primary: 210 20% 98%;
            --primary-foreground: 220.9 39.3% 11%;
            --secondary: 215 27.9% 16.9%;
            --muted: 215 27.9% 16.9%;
            --muted-foreground: 217.9 10.6% 64.9%;
            --accent: 215 27.9% 16.9%;
            --accent-foreground: 210 20% 98%;
            --border: 215 27.9% 16.9%;
            --chart-1: 220 70% 50%;
            --radius: 0.5rem;
        }
        .light {
            --background: 0 0% 100%;
            --foreground: 224 71.4% 4.1%;
            --card: 0 0% 100%;
            --card-foreground: 224 71.4% 4.1%;
            --primary: 220.9 39.3% 11%;
            --primary-foreground: 210 20% 98%;
            --secondary: 220 14.3% 95.9%;
            --muted: 220 14.3% 95.9%;
            --muted-foreground: 220 8.9% 46.1%;
            --accent: 220 14.3% 95.9%;
            --accent-foreground: 220.9 39.3% 11%;
            --border: 220 13% 91%;
            --chart-1: 220 70% 50%;
        }
        body { background-color: hsl(var(--background)); color: hsl(var(--foreground));}
        .fade-in-animate { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .recharts-cartesian-axis-tick-value { fill: hsl(var(--muted-foreground)); }
        .recharts-tooltip-cursor { stroke: hsl(var(--chart-1)); stroke-width: 1; stroke-dasharray: 3 3; }
        .dark .recharts-dot { filter: url(#glow-filter); }
    </style>
</head>
<body class="font-sans antialiased">
    <div id="app" class="flex min-h-screen w-full flex-col bg-background">
        <header class="flex h-16 items-center justify-between gap-4 border-b border-border bg-card px-6 sticky top-0 z-50">
            <div class="flex items-center gap-3">
                <h1 class="text-xl font-semibold tracking-tight text-card-foreground">Anemometer</h1>
            </div>
            <button id="theme-toggle" class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-10 w-10">
                <svg id="sun-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"><circle cx="12" cy="12" r="4"></circle><path d="M12 2v2"></path><path d="M12 20v2"></path><path d="m4.93 4.93 1.41 1.41"></path><path d="m17.66 17.66 1.41 1.41"></path><path d="M2 12h2"></path><path d="M20 12h2"></path><path d="m6.34 17.66-1.41 1.41"></path><path d="m19.07 4.93-1.41 1.41"></path></svg>
                <svg id="moon-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path></svg>
                <span class="sr-only">Toggle theme</span>
            </button>
        </header>
        <main class="flex-1 p-4 sm:p-6 md:p-8">
            <div id="dashboard-content" class="grid grid-cols-1 gap-6">
                 <!-- Cards -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="fade-in-animate" style="animation-delay: 100ms;">
                        <div class="rounded-lg border bg-card text-card-foreground shadow-sm border-dashed h-full transition-all duration-300 hover:border-primary hover:shadow-lg hover:-translate-y-1">
                            <div class="flex flex-col space-y-1.5 p-6 flex-row items-center justify-between pb-2"><h3 class="text-sm font-medium text-muted-foreground">Current Speed</h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4 text-muted-foreground"><path d="M13 3v7h6"></path><path d="M12 3v8l-7 8h14l-7-8z"></path></svg></div>
                            <div class="p-6 pt-0"><div id="current-speed" class="text-2xl font-bold tracking-tighter text-card-foreground">0.00 <span class="text-sm font-medium text-muted-foreground">km/h</span></div><p class="text-xs text-muted-foreground">Latest reading from sensor</p></div>
                        </div>
                    </div>
                    <div class="fade-in-animate" style="animation-delay: 200ms;">
                        <div class="rounded-lg border bg-card text-card-foreground shadow-sm border-dashed h-full transition-all duration-300 hover:border-primary hover:shadow-lg hover:-translate-y-1">
                            <div class="flex flex-col space-y-1.5 p-6 flex-row items-center justify-between pb-2"><h3 class="text-sm font-medium text-muted-foreground">Average speed</h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4 text-muted-foreground"><line x1="12" x2="12" y1="20" y2="10"></line><line x1="18" x2="18" y1="20" y2="4"></line><line x1="6" x2="6" y1="20" y2="16"></line></svg></div>
                            <div class="p-6 pt-0"><div id="average-speed" class="text-2xl font-bold tracking-tighter text-card-foreground">0.00 <span class="text-sm font-medium text-muted-foreground">km/h</span></div><p class="text-xs text-muted-foreground">Average of last 30 readings</p></div>
                        </div>
                    </div>
                    <div class="fade-in-animate" style="animation-delay: 300ms;">
                         <div class="rounded-lg border bg-card text-card-foreground shadow-sm border-dashed h-full transition-all duration-300 hover:border-primary hover:shadow-lg hover:-translate-y-1">
                            <div class="flex flex-col space-y-1.5 p-6 flex-row items-center justify-between pb-2"><h3 class="text-sm font-medium text-muted-foreground">Minimum Speed</h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4 text-muted-foreground"><path d="M13 3v7h6"></path><path d="M12 3v8l-7 8h14l-7-8z"></path></svg></div>
                            <div class="p-6 pt-0"><div id="min-speed" class="text-2xl font-bold tracking-tighter text-card-foreground">0.00 <span class="text-sm font-medium text-muted-foreground">km/h</span></div><p class="text-xs text-muted-foreground">Lowest reading</p></div>
                        </div>
                    </div>
                    <div class="fade-in-animate" style="animation-delay: 400ms;">
                        <div class="rounded-lg border bg-card text-card-foreground shadow-sm border-dashed h-full transition-all duration-300 hover:border-primary hover:shadow-lg hover:-translate-y-1">
                            <div class="flex flex-col space-y-1.5 p-6 flex-row items-center justify-between pb-2"><h3 class="text-sm font-medium text-muted-foreground">Maximum Speed</h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4 text-muted-foreground"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></svg></div>
                            <div class="p-6 pt-0"><div id="max-speed" class="text-2xl font-bold tracking-tighter text-card-foreground">0.00 <span class="text-sm font-medium text-muted-foreground">km/h</span></div><p class="text-xs text-muted-foreground">Highest reading</p></div>
                        </div>
                    </div>
                </div>

                <!-- Chart and Credits -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2 fade-in-animate" style="animation-delay: 500ms;">
                        <div class="rounded-lg border bg-card text-card-foreground shadow-sm h-full flex flex-col border-dashed">
                            <div class="flex flex-col space-y-1.5 p-6"><h3 class="text-lg font-semibold text-card-foreground">Real-time Wind Speed (Last 30 readings)</h3></div>
                            <div id="chart-container" class="flex-1 -mt-4 p-6 pt-0 h-full w-full min-h-[350px]"></div>
                        </div>
                    </div>
                    <div class="lg:col-span-1 fade-in-animate" style="animation-delay: 600ms;">
                        <div class="border-none shadow-none bg-transparent flex flex-col h-full rounded-lg text-card-foreground">
                            <div class="p-6 pb-4"><div class="flex items-center gap-3 mb-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="hsl(var(--primary))" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-6 w-6"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M22 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg><h3 class="text-lg font-semibold leading-none tracking-tight">A Project by BS Physics Students</h3></div><p class="text-sm text-muted-foreground">Batch 2024-2028</p></div>
                            <div class="p-6 pt-0 flex-1 flex flex-col justify-between">
                                <div class="flex flex-col gap-3">
                                    <div class="flex items-start gap-3"><div class="bg-primary/10 p-2 rounded-full"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="hsl(var(--primary))" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg></div><div><p class="text-sm font-semibold">Masoom Ali</p><p class="text-xs text-muted-foreground">Mechanical Work</p></div></div>
                                    <div class="flex items-start gap-3"><div class="bg-primary/10 p-2 rounded-full"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="hsl(var(--primary))" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg></div><div><p class="text-sm font-semibold">Muhammad Sultan Ul Arifeen</p><p class="text-xs text-muted-foreground">Programming & Electronics</p></div></div>
                                    <div class="flex items-start gap-3"><div class="bg-primary/10 p-2 rounded-full"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="hsl(var(--primary))" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"></path></svg></div><div><p class="text-sm font-semibold">Website Designed & Developed By</p><p class="text-xs text-muted-foreground">Muhammad Sultan Ul Arifeen</p></div></div>
                                </div>
                                <div class="mt-4"><hr class="shrink-0 bg-border h-[1px] w-full my-3"><div class="flex items-center gap-3 mb-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5"><path d="M11.4 2 2 11.4v10.2h10.2L22 11.4V2z"></path><path d="m15.6 6.4 1 1L8.6 16H7.6v-1z"></path></svg><p class="text-sm font-semibold">Special Thanks</p></div><div class="text-xs text-muted-foreground space-y-1"><p>Principal Azhar Kaisar</p><p>Professor Muhammad Farooq Ibadat</p></div></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Firebase and App Logic -->
    <script type="module">
        // --- START: Firebase Configuration ---
        // This configuration is public and safe to share.
        const firebaseConfig = {
            apiKey: "API_KEY",
            authDomain: "anemometer-fgsd.firebaseapp.com",
            databaseURL: "https://anemometer-fgsd-default-rtdb.firebaseio.com",
            projectId: "anemometer-fgsd",
            storageBucket: "anemometer-fgsd.appspot.com",
            messagingSenderId: "SENDER_ID",
            appId: "APP_ID",
        };
        // --- END: Firebase Configuration ---

        if (firebaseConfig.apiKey === "API_KEY") {
             document.getElementById('dashboard-content').innerHTML = `
                <div class="flex items-center justify-center h-[calc(100vh-12rem)] p-4">
                    <div role="alert" class="relative w-full max-w-xl mx-auto rounded-lg border p-4 text-destructive border-destructive/50 [&>svg]:text-destructive [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4">
                        <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path><path d="M12 9v4"></path><path d="M12 17h.01"></path></svg>
                        <h5 class="mb-1 font-medium leading-none tracking-tight">Configuration Error</h5>
                        <div class="text-sm [&_p]:leading-relaxed">Connection failed. Make sure you have replaced the placeholder API keys in the HTML file.</div>
                    </div>
                </div>
            `;
            throw new Error("Firebase configuration is not set. Please replace placeholder values in the HTML file.");
        }

        // --- Firebase SDKs ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

        // --- App State ---
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const readingsRef = ref(db, 'readings');
        let speedHistory = [];

        // --- DOM Elements ---
        const currentSpeedEl = document.getElementById('current-speed');
        const averageSpeedEl = document.getElementById('average-speed');
        const minSpeedEl = document.getElementById('min-speed');
        const maxSpeedEl = document.getElementById('max-speed');
        const chartContainer = document.getElementById('chart-container');
        const themeToggle = document.getElementById('theme-toggle');
        const sunIcon = document.getElementById('sun-icon');
        const moonIcon = document.getElementById('moon-icon');

        // --- Theme Logic ---
        const applyTheme = (theme) => {
            if (theme === 'dark') {
                document.documentElement.classList.add('dark');
                document.documentElement.classList.remove('light');
                sunIcon.classList.remove('dark:-rotate-90', 'dark:scale-0');
                moonIcon.classList.add('dark:rotate-0', 'dark:scale-100');
            } else {
                document.documentElement.classList.remove('dark');
                document.documentElement.classList.add('light');
                sunIcon.classList.add('dark:-rotate-90', 'dark:scale-0');
                moonIcon.classList.remove('dark:rotate-0', 'dark:scale-100');
            }
        };

        const toggleTheme = () => {
            const isDark = document.documentElement.classList.contains('dark');
            const newTheme = isDark ? 'light' : 'dark';
            localStorage.setItem('theme', newTheme);
            applyTheme(newTheme);
            renderChart(speedHistory); // Re-render chart with new theme colors
        };
        
        themeToggle.addEventListener('click', toggleTheme);

        // --- Chart Logic ---
        const { AreaChart, Area, XAxis, YAxis, Tooltip, ResponsiveContainer, CartesianGrid } = Recharts;
        const renderChart = (data) => {
            const isDark = document.documentElement.classList.contains('dark');
            const axisColor = isDark ? '#FFFFFF' : '#666666';
            const chartElement = React.createElement(ResponsiveContainer, { width: "100%", height: "100%" },
                React.createElement(AreaChart, { data, margin: { top: 5, right: 20, left: -10, bottom: 20 } },
                    React.createElement('defs', null, 
                        React.createElement('linearGradient', { id: 'colorSpeed', x1: '0', y1: '0', x2: '0', y2: '1' },
                            React.createElement('stop', { offset: '5%', stopColor: 'hsl(var(--chart-1))', stopOpacity: 0.4 }),
                            React.createElement('stop', { offset: '95%', stopColor: 'hsl(var(--chart-1))', stopOpacity: 0 })
                        ),
                        React.createElement('filter', { id: 'glow-filter', x: '-50%', y: '-50%', width: '200%', height: '200%' },
                            React.createElement('feGaussianBlur', { in: 'SourceGraphic', stdDeviation: '5', result: 'blur' })
                        )
                    ),
                    React.createElement(XAxis, { dataKey: "time", stroke: axisColor, fontSize: 12, tickLine: false, axisLine: { stroke: axisColor, opacity: 0.2 }, tickMargin: 10 }),
                    React.createElement(YAxis, { stroke: axisColor, fontSize: 12, tickLine: false, axisLine: { stroke: axisColor, opacity: 0.2 }, tickMargin: 10, domain: [0, 'dataMax + 5'] }),
                    React.createElement(Tooltip, { 
                        contentStyle: { 
                            backgroundColor: 'hsl(var(--background) / 0.8)',
                            borderColor: 'hsl(var(--border))',
                            color: 'hsl(var(--foreground))'
                        },
                        cursor: { stroke: "hsl(var(--chart-1))", strokeWidth: 1, strokeDasharray: "3 3" }
                    }),
                    React.createElement(Area, { 
                        type: "monotone", 
                        dataKey: "speed", 
                        stroke: "hsl(var(--chart-1))", 
                        strokeWidth: 2,
                        fillOpacity: 1, 
                        fill: "url(#colorSpeed)",
                        className: isDark ? "dark:[filter:url(#glow-filter)]" : "",
                        dot: false,
                        activeDot: { r: 6 }
                    })
                )
            );
            ReactDOM.render(chartElement, chartContainer);
        };

        // --- Data Processing ---
        const updateDashboard = (history) => {
            if (history.length === 0) return;

            const speeds = history.map(s => s.speed);
            const validSpeeds = speeds.filter(s => s > 0);

            const current = speeds[speeds.length - 1] || 0;
            const avg = validSpeeds.length > 0 ? validSpeeds.reduce((a, b) => a + b, 0) / validSpeeds.length : 0;
            const min = validSpeeds.length > 0 ? Math.min(...validSpeeds) : 0;
            const max = validSpeeds.length > 0 ? Math.max(...validSpeeds) : 0;

            currentSpeedEl.innerHTML = `${current.toFixed(2)} <span class="text-sm font-medium text-muted-foreground">km/h</span>`;
            averageSpeedEl.innerHTML = `${avg.toFixed(2)} <span class="text-sm font-medium text-muted-foreground">km/h</span>`;
            minSpeedEl.innerHTML = `${min.toFixed(2)} <span class="text-sm font-medium text-muted-foreground">km/h</span>`;
            maxSpeedEl.innerHTML = `${max.toFixed(2)} <span class="text-sm font-medium text-muted-foreground">km/h</span>`;
            
            speedHistory = history;
            renderChart(history);
        };

        // --- Firebase Listener ---
        onValue(readingsRef, (snapshot) => {
            const data = snapshot.val();
            if (data) {
                const newHistory = Object.values(data).map(d => ({
                    speed: typeof d.speed === 'number' ? d.speed : 0,
                    timestamp: typeof d.timestamp === 'number' ? d.timestamp : Date.now(),
                    time: new Date(d.timestamp || Date.now()).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
                }))
                .filter(d => d.timestamp > 0)
                .sort((a, b) => a.timestamp - b.timestamp)
                .slice(-30);
                updateDashboard(newHistory);
            }
        });

        // --- Initial Load ---
        const savedTheme = localStorage.getItem('theme') || 'dark';
        applyTheme(savedTheme);
        renderChart([]); // Initial render
    </script>
</body>
</html>
    
